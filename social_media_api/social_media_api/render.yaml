# Render Blueprint to define the infrastructure

# 1. Database Definition
databases:
  - name: socialmedia_db
    plan: free # Note: Free DBs expire after 30 days on Render.
    databaseName: socialmedia_db
    user: socialmedia_user

# 2. Web Service Definition (Your Django API)
services:
  - type: web
    name: socialmedia-api
    env: python
    
    rootDir: social_media_api
    # 2a. Build Command: Runs once during deployment
    buildCommand: "pip install -r requirements.txt && python manage.py collectstatic --noinput"
    
    # 2b. Start Command: Runs every time the service starts (using Gunicorn)
    startCommand: "gunicorn social_media_api.wsgi" 
    
    # 2c. Environment Variables: Securely setting credentials
    envVars:
      # Automatically set by Render, pointing to the database defined above
      - key: DATABASE_URL 
        fromDatabase:
          name: socialmedia_db
          property: connectionString
      
      # Recommended number of Gunicorn workers (usually 2*CPU + 1). 
      # On the free tier, 4 is a safe default.
      - key: WEB_CONCURRENCY
        value: 4 
      
      # Render generates a strong, random SECRET_KEY for security
      - key: SECRET_KEY
        generateValue: true 
      
      # Ensure Django is running in production mode
      - key: DEBUG
        value: "False"
      
      # Allows Render to handle the hostname/domain check
      - key: ALLOWED_HOSTS
        value: "*"